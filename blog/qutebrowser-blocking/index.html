<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>LeechBlock in qutebrowser | S. Verona Malone</title><meta name=title content="LeechBlock in qutebrowser"><meta name=description content="My anti-doomscrolling apparatus."><meta name=keywords content><meta property="og:title" content="LeechBlock in qutebrowser"><meta property="og:description" content="My anti-doomscrolling apparatus."><meta property="og:type" content="article"><meta property="og:url" content="https://sverona.dev/blog/qutebrowser-blocking/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-07-07T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-07T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="LeechBlock in qutebrowser"><meta name=twitter:description content="My anti-doomscrolling apparatus."><meta itemprop=name content="LeechBlock in qutebrowser"><meta itemprop=description content="My anti-doomscrolling apparatus."><meta itemprop=datePublished content="2022-07-07T00:00:00+00:00"><meta itemprop=dateModified content="2022-07-07T00:00:00+00:00"><meta itemprop=wordCount content="210"><meta itemprop=keywords content><meta name=referrer content="no-referrer-when-downgrade"><link href=https://sverona.dev/sass/style.css type=text/css rel=stylesheet><link href=https://sverona.dev/sass/sidenotes.css type=text/css rel=stylesheet><link href=https://sverona.dev/katex/katex.css type=text/css rel=preload as=style onload='this.onload=null,this.rel="stylesheet"'><script defer src=https://sverona.dev/katex/katex.js></script>
<script defer src=https://sverona.dev/katex/contrib/auto-render.js></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"\\(",right:"\\)",display:!1},{left:"\\begin{align}",right:"\\begin{align}",display:!0},{left:"\\[",right:"\\]",display:!0}]})})</script></head><body><header id=header><a href=/ class=title id=brand><span id=accent></span>S. Verona Malone</a><nav><ul><li><a href=/blog>blog</a></li><li><a href=https://github.com/sverona>github</a></li><li><a href=/about>about</a></li></ul></nav></header><main><header id=front-matter><nav><div id=current-section><a href=https://sverona.dev/blog/>Blogs</a></div><div id=next-prev><span>&Larr; <a href=https://sverona.dev/blog/amazing-graphs/>Refurbishing an old Twitter bot</a></span>
<span><a href=https://sverona.dev/blog/automating-actual/>Automating transaction imports with Actual</a> &Rarr;</span></div></nav><div><time datetime=2022-07-07 pubdate>July 7, 2022</time><h1>LeechBlock in qutebrowser</h1><em id=page-description>My anti-doomscrolling apparatus.</em><br></div></div></header><article><div id=toc class=margin-toggle><h2>Table of Contents</h2><nav id=TableOfContents></nav></div><p>I use <a href=https://github.com/qutebrowser/qutebrowser>qutebrowser</a> as my daily driver. With the exception of the errant ad that Firefox or Chrome would catch,<label for=sidenote-0 class="margin-toggle sidenote-number"></label>
<input type=checkbox id=sidenote-0 class=margin-toggle><span class=sidenote>An <a href=https://github.com/qutebrowser/qutebrowser/issues/6480>active area of research.</a></span>
there is nothing to complain about.</p><p>Unfortunately I&rsquo;ve developed a nasty habit of unthinkingly typing in anxiogenic websites. The usual solution on Chrome/Firefox is <a href=https://www.proginosko.com/leechblock/>LeechBlock</a>, but qutebrowser naturally doesn&rsquo;t support extensions.<label for=sidenote-1 class="margin-toggle sidenote-number"></label>
<input type=checkbox id=sidenote-1 class=margin-toggle><span class=sidenote>I&rsquo;m honestly fine with this design choice; most of the extensions I would need are implementable as user stylesheets/scripts/plugins, this one included. Keep it simple, S.</span></p><p>Fortunately, it <em>does</em> have <a href=https://github.com/qutebrowser/qutebrowser/blob/master/qutebrowser/browser/webengine/interceptor.py>an interface</a> to intercept outgoing requests. Even more fortunately, <a href=http://jgkamat.gitlab.io/>Jay Kamat</a> wrote <a href=https://gitlab.com/jgkamat/dotfiles/-/blob/master/qutebrowser/.config/qutebrowser/pyconfig/redirectors.py>most of the plumbing for what I need.</a></p><p>The following is graciously adapted from its code:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=font-weight:700>from</span> <span style=color:#555>typing</span> <span style=font-weight:700>import</span> Literal
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=color:#555>qutebrowser.api</span> <span style=font-weight:700>import</span> interceptor
</span></span><span style=display:flex><span><span style=font-weight:700>from</span> <span style=color:#555>PyQt5.QtCore</span> <span style=font-weight:700>import</span> QUrl
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BREATHER <span style=font-weight:700>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#998;font-style:italic># Sites to block here...</span>
</span></span><span style=display:flex><span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>redirect_to</span>(qurl: QUrl) <span style=font-weight:700>-&gt;</span> QUrl <span style=font-weight:700>|</span> Literal[<span style=font-weight:700>False</span>]:
</span></span><span style=display:flex><span>    <span style=color:#b84>&#34;&#34;&#34;Return the URL to which `qurl` should be redirected,
</span></span></span><span style=display:flex><span><span style=color:#b84>    or False if no redirect is to be performed.
</span></span></span><span style=display:flex><span><span style=color:#b84>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    url <span style=font-weight:700>=</span> qurl<span style=font-weight:700>.</span>url()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> <span style=color:#999>any</span>(domain <span style=font-weight:700>in</span> url <span style=font-weight:700>for</span> domain <span style=font-weight:700>in</span> BREATHER):
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span> QUrl(<span style=color:#b84>&#34;https://sverona.dev/breather/&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> <span style=font-weight:700>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> <span style=color:#900;font-weight:700>intercept</span>(req: interceptor<span style=font-weight:700>.</span>Request):
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> (req<span style=font-weight:700>.</span>resource_type <span style=font-weight:700>!=</span> interceptor<span style=font-weight:700>.</span>ResourceType<span style=font-weight:700>.</span>main_frame <span style=font-weight:700>or</span>
</span></span><span style=display:flex><span>            req<span style=font-weight:700>.</span>request_url<span style=font-weight:700>.</span>scheme() <span style=font-weight:700>in</span> {<span style=color:#b84>&#34;data&#34;</span>, <span style=color:#b84>&#34;blob&#34;</span>}):
</span></span><span style=display:flex><span>        <span style=font-weight:700>return</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    url <span style=font-weight:700>=</span> req<span style=font-weight:700>.</span>request_url
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    redir <span style=font-weight:700>=</span> redirect_to(url)
</span></span><span style=display:flex><span>    <span style=font-weight:700>if</span> redir:
</span></span><span style=display:flex><span>        req<span style=font-weight:700>.</span>redirect(redir)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>interceptor<span style=font-weight:700>.</span>register(intercept)
</span></span></code></pre></div><p>I have this in <code>~/.config/qutebrowser/pyconfig/block.py</code>.</p><p>May your mental health never falter.</p></article><hr></main><footer>Made with <a href=https://github.com/sverona/hugo-semiotic>Hugo Semiotic</a></footer></body></html>