<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LeechBlock in qutebrowser | S. Verona Li≈°kov√°</title>
<meta name="title" content="LeechBlock in qutebrowser" />
<meta name="description" content="My anti-doomscrolling apparatus." />
<meta name="keywords" content="mental-health,python,qutebrowser,2022," />


<meta property="og:title" content="LeechBlock in qutebrowser" />
<meta property="og:description" content="My anti-doomscrolling apparatus." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://sverona.dev/blog/qutebrowser-blocking/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2022-07-07T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-07-07T00:00:00+00:00" />




<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="LeechBlock in qutebrowser"/>
<meta name="twitter:description" content="My anti-doomscrolling apparatus."/>



<meta itemprop="name" content="LeechBlock in qutebrowser">
<meta itemprop="description" content="My anti-doomscrolling apparatus."><meta itemprop="datePublished" content="2022-07-07T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-07-07T00:00:00+00:00" />
<meta itemprop="wordCount" content="208">
<meta itemprop="keywords" content="mental-health,python,qutebrowser,2022," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  
  <link href="https://sverona.dev/fonts/fonts.css" type="text/css" rel="stylesheet" />
  
  
  <link href="https://sverona.dev/sass/style.css" type="text/css" rel="stylesheet" />
  <link href="https://sverona.dev/sass/sidenotes.css" type="text/css" rel="stylesheet" />
  

  <script>
    // @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&dn=gpl-3.0.txt GPL-3.0

    

    document.addEventListener("DOMContentLoaded", () => {
      var els = document.getElementsByClassName("highlight");
      for (var i = 0; i < els.length; i++) {
        if (els[i].title.length) {
          var newNode = document.createElement("code");
          var textNode = document.createTextNode(els[i].title);
          newNode.appendChild(textNode);
          newNode.classList.add("highlight-title");
          var pre = els[i].querySelector('pre');
          pre.appendChild(newNode);
        }
      }
    });
    // @license-end
  </script>

</head>

<body>
  <header id="header"><a href="/" class="title" id="brand">
  <img src="/favicon.ico"> <strong>S. Verona Li≈°kov√°</strong>
</a>
<nav><ul class="horizontal-list">

<li><a href="/about">about</a></li>

</ul>
</nav>
</header>
  <main><noscript>
  <section style="background-color: #e6e8fa; margin-block: 1rem; padding: 1px 1rem; box-shadow: 2px 2px #000">
    <p>Hello, sentient being who has disabled JavaScript/is using <a href="https://www.gnu.org/software/librejs/index.html">LibreJS</a>!</p>
    <p>This site uses as little JavaScript as I can get away with, but it does require JS to:</p>
<ol>
  <li>render mathematics; for this purpose I use <a href="https://katex.org">KaTeX</a>, which is freely licensed (and partially trans-made! üè≥Ô∏è‚Äçüåà)</li>
  <li>slightly extend Hugo's <a href="https://gohugo.io/content-management/syntax-highlighting/#highlight-shortcode">highlight shortcode</a> to show filenames in code listings. (The actual syntax highlighting is done server-side.)</li>
</ol>
    <p>This site validates under LibreJS as of 6 September 2022. If you find otherwise, please contact me.</p>
  </section>
</noscript>

<header id="front-matter">
  <h1>LeechBlock in qutebrowser</h1>
  <p class="subtitle"><date>7 July 2022</date></p>
  
  <ul class="horizontal-list page-tags">
      
        <li><a href="https://sverona.dev/tags/mental-health/">mental-health</a></li>
      
        <li><a href="https://sverona.dev/tags/python/">python</a></li>
      
        <li><a href="https://sverona.dev/tags/qutebrowser/">qutebrowser</a></li>
      
        <li><a href="https://sverona.dev/tags/2022/">2022</a></li>
      
  </ul>
  
</div>
</header>

<article>
  
  <p>I use <a href="https://github.com/qutebrowser/qutebrowser">qutebrowser</a> as my daily driver. With the exception of the errant ad that Firefox or Chrome would catch,<label for="sidenote-0" class="margin-toggle sidenote-number "></label><input type="checkbox" id="sidenote-0" class="margin-toggle"/><span class="sidenote ">An <a href="https://github.com/qutebrowser/qutebrowser/issues/6480">active area of research.</a></span> there is nothing to complain about.</p>
<p>Unfortunately I&rsquo;ve developed a nasty habit of unthinkingly typing in anxiogenic websites. The usual solution on Chrome/Firefox is <a href="https://www.proginosko.com/leechblock/">LeechBlock</a>, but qutebrowser naturally doesn&rsquo;t support extensions.<label for="sidenote-1" class="margin-toggle sidenote-number "></label><input type="checkbox" id="sidenote-1" class="margin-toggle"/><span class="sidenote ">I&rsquo;m honestly fine with this design choice; most of the extensions I would need are implementable as user stylesheets/scripts/plugins, this one included. Keep it simple, S.</span></p>
<p>Fortunately, it <em>does</em> have <a href="https://github.com/qutebrowser/qutebrowser/blob/master/qutebrowser/browser/webengine/interceptor.py">an interface</a> to intercept outgoing requests. Even more fortunately, <a href="http://jgkamat.gitlab.io/">Jay Kamat</a> wrote <a href="https://gitlab.com/jgkamat/dotfiles/-/blob/master/qutebrowser/.config/qutebrowser/pyconfig/redirectors.py">most of the plumbing for what I need.</a></p>
<p>The following is graciously adapted from its code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#666;font-weight:bold;font-style:italic">typing</span> <span style="font-weight:bold">import</span> Literal
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#666;font-weight:bold;font-style:italic">qutebrowser.api</span> <span style="font-weight:bold">import</span> interceptor
</span></span><span style="display:flex;"><span><span style="font-weight:bold">from</span> <span style="color:#666;font-weight:bold;font-style:italic">PyQt5.QtCore</span> <span style="font-weight:bold">import</span> QUrl
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>BREATHER = [
</span></span><span style="display:flex;"><span>    <span style="color:#888;font-style:italic"># Sites to block here...</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#666;font-weight:bold;font-style:italic">redirect_to</span>(qurl: QUrl) -&gt; QUrl | Literal[<span style="font-weight:bold">False</span>]:
</span></span><span style="display:flex;"><span>    <span style="color:#666;font-style:italic">&#34;&#34;&#34;Return the URL to which `qurl` should be redirected,
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">    or False if no redirect is to be performed.
</span></span></span><span style="display:flex;"><span><span style="color:#666;font-style:italic">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    url = qurl.url()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span> <span style="font-weight:bold;font-style:italic">any</span>(domain <span style="font-weight:bold">in</span> url <span style="font-weight:bold">for</span> domain <span style="font-weight:bold">in</span> BREATHER):
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">return</span> QUrl(<span style="color:#666;font-style:italic">&#34;https://sverona.dev/breather/&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">return</span> <span style="font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">def</span> <span style="color:#666;font-weight:bold;font-style:italic">intercept</span>(req: interceptor.Request):
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span> (req.resource_type != interceptor.ResourceType.main_frame <span style="font-weight:bold">or</span>
</span></span><span style="display:flex;"><span>            req.request_url.scheme() <span style="font-weight:bold">in</span> {<span style="color:#666;font-style:italic">&#34;data&#34;</span>, <span style="color:#666;font-style:italic">&#34;blob&#34;</span>}):
</span></span><span style="display:flex;"><span>        <span style="font-weight:bold">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    url = req.request_url
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    redir = redirect_to(url)
</span></span><span style="display:flex;"><span>    <span style="font-weight:bold">if</span> redir:
</span></span><span style="display:flex;"><span>        req.redirect(redir)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>interceptor.register(intercept)
</span></span></code></pre></div><p>I have this in <code>~/.config/qutebrowser/pyconfig/block.py</code>.</p>
<p>May your mental health never falter.</p>

</article>

  </main>
  <footer></footer>

    
</body>

</html>
